FROM exense/step:k8s-base-latest-java-8
MAINTAINER jonathan.rubiero@exense.ch
RUN useradd -m -U -u 1000 agent
RUN mkdir /home/agent/log && chown -R agent:agent /home/agent/log
COPY --chown=agent:agent . /home/agent/
RUN echo "agent ALL=(ALL) NOPASSWD: ALL" > etc/sudoers.d/agent
RUN chmod 440 /etc/sudoers.d/agent
ENV STEP_KV ""
ENV STEP_DP ""
USER agent
WORKDIR /home/agent/bin/
RUN chmod +x ../mergeProperties.sh ../installDependencies.sh startAgent.sh
CMD ../mergeProperties.sh ../conf/AgentConf.json && ../installDependencies.sh && ./startAgent.sh