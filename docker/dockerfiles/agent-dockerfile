FROM exense/step:k8s-base-latest
MAINTAINER jonathan.rubiero@exense.ch
RUN useradd -m -U -u 1000 agent
RUN mkdir /home/agent/log && chown -R agent:agent /home/agent/log
COPY --chown=agent:agent . /home/agent/
RUN echo "agent ALL=(ALL) NOPASSWD: ALL" > etc/sudoers.d/agent
RUN chmod 440 /etc/sudoers.d/agent
ENV STEP_KV ""
ENV STEP_DP ""
USER agent
RUN chmod +x /home/agent/mergeProperties.sh /home/agent/installDependencies.sh /home/agent/bin/startAgent.sh
WORKDIR /home/agent/bin/
CMD ../mergeProperties.sh ../conf/AgentConf.json && ../installDependencies.sh && ./startAgent.sh